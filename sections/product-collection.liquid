 {%- liquid
  assign motion_delay = 50

-%}
<style>
    #shopify-section-{{ section.id }}{background:{{ section.settings.section_bg_color }}}
    #shopify-section-{{ section.id }} .product-collection{ padding-top: {{ section.settings.padding_top }}px;padding-bottom: {{ section.settings.padding_bottom }}px;}
    #shopify-section-{{ section.id }} .product-collection .title{ font-size: 46px;font-weight: 700;text-align:center;color:#000}
    #shopify-section-{{ section.id }} .product-collection-box{margin-top:40px}
    #shopify-section-{{ section.id }} .product-collection-box .slick-list{margin-left: -20px;width: 103%;}
    #shopify-section-{{ section.id }} .product-collection-box .slick-track{display:flex; gap:1rem;justify-content: space-between;}
    #shopify-section-{{ section.id }} .product-collection-box .custom-product-image{ border-radius: 20px; background: #F5F5F5;}
    #shopify-section-{{ section.id }} .product-collection-box .custom-product-image img{
    {% comment %} height:{{ section.settings.image_height}}px!important; {% endcomment %}
    border-radius:20px}
    #shopify-section-{{ section.id }} .product-collection-box .custom-product-title,.product-collection-box .custom-product-price{font-family: 'Inter';margin-top:8px;text-align: left;line-height:24px;
     font-size: 19px;font-weight: 600;color: #1A1A1A;}
    #shopify-section-{{ section.id }} .product-collection-box .custom-product-title{min-height: 48px;max-height: 48px;display: -webkit-box;-webkit-line-clamp: 3;-webkit-box-orient: vertical; overflow: hidden;text-overflow: ellipsis;}
    #shopify-section-{{ section.id }} .product-collection-box .custom-product-describe{
      {% comment %} min-height: 17px;max-height:34px; -webkit-line-clamp: 2;{% endcomment %}
       display:flex;flex-flow:column;
      margin-top:10px;line-height: normal;line-height:25px;font-size:14px;font-weight: 400;color: #1A1A1A;text-align: left;
    display: -webkit-box;-webkit-box-orient: vertical; overflow: hidden;text-overflow: ellipsis;
    max-height:120px;
  }
   #shopify-section-{{ section.id }} .describe-min-height{min-height: 100px;}
   #shopify-section-{{ section.id }} .product-collection-box .item{ display:flex;flex-direction:column;justify-content:space-between;height:100%;border-radius:20px;background:{{section.settings.content_color}};}
   #shopify-section-{{ section.id }} .product-collection-box .content-box{ padding: 0px 20px 30px 20px;}
   #shopify-section-{{ section.id }} .product-collection-box .custom-product-describe .icon-vector{margin-right:8px;vertical-align: middle;}
   #shopify-section-{{ section.id }} .product-collection-box .custom-product-price{margin-top:17px;font-size:18px;text-align: left;color: #3250C3;}
   #shopify-section-{{ section.id }} .product-collection-box .custom-product-price .original-price{font-weight: 500;color: #8D8D8D;text-decoration: line-through;}
   #shopify-section-{{ section.id }} .product-collection-box .custom-product-button{display:flex;
    {% comment %} left: 50%;transform: translateX(-50%); {% endcomment %}
    margin-top:14px;max-width:220px;min-width:100%;min-height:{{ section.settings.button_height }}px;color:{{  section.settings.button_title_color }}}
   #shopify-section-{{ section.id }} .product-collection-box .custom-product-button:hover{color:#fff}
   .section-product-collection .slick-dotted .slick-dots{visibility:hidden;margin-top:0px}
   #shopify-section-{{ section.id }} .hotsale{margin-top:20px;line-height:17px;font-size: 14px;color:#EF0F0F;font-weight: 600;}
   #shopify-section-{{ section.id }} .content-box .button-wrap{ display:flex;justify-content:{{ section.settings.button_alignment }}}
   #shopify-section-{{ section.id }} .home-size{ line-height:24px;font-size: 18px;}
   #shopify-section-{{ section.id }} .kv-size{ line-height:29px;font-size: 24px;}
   #shopify-section-{{ section.id }} .btn--black{ background:#212121;color:#fff}
   #shopify-section-{{ section.id }} .cyber-monday{ background:transparent;border-color:#481D0D}
   #shopify-section-{{ section.id }} .describe-min-height{min-height: {{ section.settings.sale-min_height }}px;}
 @media (max-width: 1140px) {
 {% comment %} .product-collection-box .custom-product-button{min-width:160px;max-width:160px} {% endcomment %}
 #shopify-section-{{ section.id }} .product-collection-box .custom-product-title{min-height:32px;}
}
 @media (max-width: 1023px) {
 .section-product-collection .slick-dotted .slick-dots {margin-top:30px;display: flex ;visibility:visible;gap:8px;align-items: center;justify-content: center;}
 .slick-dotted .slick-dots .slick-active button{ background: #3250C3;}
 .slick-dotted .slick-dots button {
    padding:0px;
    width: 20px;
    height: 4px;
    border-radius:2px;
    background: #D9D9D9;
    color: transparent;
    transition: all .4s ease;
  }
}
.slick-dotted.slick-slider {
  margin-bottom: 0px;
}
 @media (max-width: 768px) {
  .section-product-collection .slick-dotted .slick-dots{margin-top:1rem;gap:0px}
   #shopify-section-{{ section.id }} .product-collection{ padding-top: {{ section.settings.padding_top | divided_by: 2  }}px;padding-bottom: {{ section.settings.padding_bottom | divided_by: 2 }}px;}
   #shopify-section-{{ section.id }} .product-collection .title{ font-size: 28px;}
   #shopify-section-{{ section.id }} .product-collection-box{margin-top:2rem}
   #shopify-section-{{ section.id }} .product-collection-box .slick-list{margin-left:-10px;width: 105%;}
   #shopify-section-{{ section.id }} .product-collection-box .content-box{padding:0 30px;}
   #shopify-section-{{ section.id }} .product-collection-box .custom-product-image img{height:auto!important}
  {% comment %} .product-collection-box .custom-product-button{min-width:240px;max-width:240px;min-height:{{ section.settings.mobile_button_height }}px;} {% endcomment %}
  #shopify-section-{{ section.id }} .product-collection-box .custom-product-button{min-width:100%;max-width:240px;min-height:{{ section.settings.mobile_button_height }}px;}
  #shopify-section-{{ section.id }} .product-collection-box .item{position:relative;height:unset;border-radius: 20px;background:{{section.settings.content_color}};padding-bottom: 34px;}
  #shopify-section-{{ section.id }} .product-collection-box .custom-product-title,.product-collection-box .custom-product-price{font-size:16px;}
  #shopify-section-{{ section.id }} .product-collection-box .custom-product-describe{max-height:135px;line-height:19px}
  #shopify-section-{{ section.id }} .product-collection-box .custom-product-title{max-height:48px;min-height:48px;}
  .slick-dots li.slick-active button:before,.slick-dots li button:before{display:none}
  #shopify-section-{{ section.id }} .product-collection-box .describe-min-height{min-height: {{ section.settings.mob-sale-min_height }}!important;}

}

</style>
<div class="section section-product-collection section--padding page-width" style=" background:{{ section.settings.bg_color }}" id="{{ section.settings.id }}">
    <div class="product-collection">
      <h2 class="title"  style="color:{{ section.settings.title_color }}"> <motion-element class="block" data-motion="fade-up" data-motion-delay="{{ motion_delay }}"><span>{{section.settings.title}}</span></motion-element></h2>
      <div class="product-collection-box">
      
            {% for block in section.blocks %}
              {% assign product = all_products[block.settings.product_item] %}
              {% if product != blank %} 
                <div class="item slick-slide" >
                  <a href="{% if block.settings.button_link != blank %}{{  block.settings.button_link }}{% else %}{{ product.url }}{% endif %}" class="custom-product-card">
                    {% if block.settings.custom_image != blank %}
                      <div class="custom-product-image">
                        {% comment %} {{
                          block.settings.custom_image
                          | image_url: width: 600
                          | image_tag: loading: 'lazy', alt: block.settings.custom_title | default: product.title
                        }} {% endcomment %}
                             <picture>
                        <source
                          media="(max-width: 749px)"
                          srcset="
                            {{ block.settings.mobile_image | default: block.settings.image | img_url: '800x' }} 1x,
                            {{ block.settings.mobile_image | default: block.settings.image | img_url: '1600x' }} 2x
                          "
                        >
                        <source
                          media="(min-width: 750px)"
                          srcset="
                            {{ block.settings.custom_image | img_url: '1200x' }} 1x,
                            {{ block.settings.custom_image | img_url: '2400x' }} 2x
                          "
                        >
                        <img
                          src="{{ block.settings.custom_image | img_url: '1200x' }}"
                          alt="{{ block.settings.title | escape }}"
                          class="grid-image"
                          loading="lazy"
                          width="100%"
                          height="100%"
                        >
                      </picture>
                      </div>
                    {% else %}
                     <div class="custom-product-image">
                        {{
                          product.featured_image
                          | image_url: width: 600
                          | image_tag: loading: 'lazy', alt: block.settings.title
                        }}
                      </div> 
                    {% endif %}
                    
                     <div class="content-box">
                      {% if block.settings.hotsale != blank %}
                        <div class="hotsale">{{ block.settings.hotsale }}</div>
                      {% endif %}
                        <h3 class="custom-product-title">
                          {{ block.settings.custom_title | default: block.settings.title }}
                        </h3>
                        {%- assign desc_list = block.settings.custom_describe | split: '\n' -%}
                        {% if desc_list.size > 1 %}
                          <ul class="custom-product-describe describe-min-height">
                            {% for desc in desc_list %}
                              {% if desc != blank %}
                                <li>
                                  {%- if section.settings.list_style == 'home-list' -%}
                                    {% render 'icon-vector' -%}
                                  {%- elsif section.settings.list_style == 'kv-list' -%}
                                    {% render 'icon-disc' -%}
                                  {%- endif -%}
                                  {{- desc }}
                                </li>
                              {% endif %}
                            {% endfor %}
                          </ul>
                        {% else %}
                          <div class="custom-product-describe describe-min-height">{{ block.settings.custom_describe }}</div>
                        {% endif %}
                        {%- assign size_class = '' -%}
                        {%- if section.settings.product_onsale == 'home-size' -%}
                          {%- assign size_class = 'home-size' -%}
                        {%- elsif section.settings.product_onsale == 'kv-size' -%}
                          {%- assign size_class = 'kv-size' -%}
                        {%- endif -%}
                        <div class="bottom-box">
                          <div class="custom-product-price">
                            <span class="current-price {{size_class}}"> {{ block.settings.price }}</span>
                            <span class="original-price">{{ block.settings.original }}</span>
                          </div>
                          <div class="button-wrap">
                            <button class="btn {{ section.settings.button_color }} links custom-product-button">
                              {{ block.settings.button_text }}
                            </button>
                        </div>
                      </div>
                      </div>
                  </a>
                </div>
               {% endif %}
            {% endfor %} 
          </div>


  
    </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const productShowCount = {{ section.settings.product_show_count }};
    const productShowCountMob = {{ section.settings.product_show_count_mob }};
    $('.product-collection-box').slick({
      dots: true,
      arrows: false,
      {% comment %} centerMode: true,
      centerPadding: '0px', {% endcomment %}
      slidesToShow: productShowCount,
      responsive: [ // 响应式配置
        {
          breakpoint: 1023,
          settings: { slidesToShow: 2 }
        },
        {
          breakpoint: 640,
          settings: { 
            slidesToScroll: 1,
            infinite: false, 
            variableWidth: false,
            adaptiveHeight: true,
            mobileFirst: true,
            slidesToShow: productShowCountMob
          }
        }
      ]
    });
  });
</script>
{% schema %}
{
  "name": "product_collection",
  "tag": "section",
  "class": "section section-product-collection-bg",
  "max_blocks": 10,
  "disabled_on": {
    "groups": ["header", "footer", "custom.overlay"]
  },
  "settings": [
     {
      "type": "text",
      "id": "id",
      "label": "ID"
    },
    {
      "type": "text",
      "id": "title",
      "label": "标题"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "t:sections.all.padding.padding_top",
      "default": 50,
      "min": 0,
      "max": 180,
      "step": 2,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 50,
      "min": 0,
      "max": 180,
      "step": 2,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "button_height",
      "label": "PC按钮高度",
      "default": 48,
      "min": 0,
      "max": 180,
      "step": 2,
      "unit": "px"
    },
     {
      "type": "range",
      "id": "mobile_button_height",
      "label": "Mobile按钮高度",
      "default": 40,
      "min": 0,
      "max": 180,
      "step": 2,
      "unit": "px"
    },
    {
      "type": "text",
      "id": "section_bg_color",
      "label": "section背景颜色",
      "default": "#ffffff"
    },
    {
      "type": "text",
      "id": "bg_color",
      "label": "背景颜色"
    },
    {
      "type": "color",
      "id": "content_color",
      "label": "内容背景颜色",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "标题颜色",
      "default": "#000"
    },
    {
      "type": "color",
      "id": "button_title_color",
      "label": "按钮文本颜色",
      "default": "#1A1A1A"
    },
    {
      "type": "select",
      "id": "button_color",
      "label": "按钮颜色",
       "options": [
        {
          "value": "btn--secondary",
          "label": "btn--secondary"
        },
        {
          "value": "btn--black",
          "label": "btn--black"
        },
       {
          "value": "cyber-monday",
          "label": "cyber-monday"
        },
      ],
      "default": "btn--secondary",
    },
    {
      "type": "text",
      "id": "image_height",
      "label": "图片高度",
      "default": "216"
    },
    {
      "type": "text",
      "id": "sale-min_height",
      "label": "卖点最小高度",
      "default": "100"
    },
    {
      "type": "text",
      "id": "mob-sale-min_height",
      "label": "移动端卖点最小高度",
      "default": "100"
    },
    {
      "type": "select",
      "id": "product_show_count",
      "label": "产品一行显示个数",
       "options": [
        {
          "value": "3",
          "label": "3"
        },
        {
          "value": "4",
          "label": "4"
        },
      ],
      "default": "4",
    },
    {
      "type": "select",
      "id": "product_show_count_mob",
      "label": "移动端产品一行显示个数",
       "options": [
        {
          "value": "1",
          "label": "1"
        },
        {
          "value": "1.2",
          "label": "1.2"
        },
      ],
      "default": "1",
    },
    {
      "type": "select",
      "id": "product_onsale",
      "label": "产品售价字体大小",
       "options": [
        {
          "value": "home-size",
          "label": "home-size"
        },
        {
          "value": "kv-size",
          "label": "kv-size"
        },
      ],
      "default": "home-size",
    },
     {
      "type": "select",
      "id": "list_style",
      "label": "list样式",
       "options": [
        {
          "value": "home-list",
          "label": "home-list"
        },
        {
          "value": "kv-list",
          "label": "kv-list"
        },
      ],
      "default": "home-list",
    },
    {
      "type": "select",
      "id": "button_alignment",
      "options": [
        {
          "value": "left",
          "label": "t:sections.all.text_alignment.options__1.label"
        },
        {
          "value": "center",
          "label": "t:sections.all.text_alignment.options__2.label"
        },
        {
          "value": "right",
          "label": "t:sections.all.text_alignment.options__3.label"
        }
      ],
      "default": "left",
      "label": "按钮位置"
    },
  ],
 "blocks": [
    {
      "type": "card",
      "name": "产品",
      "settings": [
        {
          "type": "product",
          "id": "product_item",
          "label": "product"
        },
        
        {
          "type": "image_picker",
          "id": "custom_image",
          "label": "image_pc"
        },
        {
          "type": "image_picker",
          "id": "mobile_image",
          "label": "image_mobile"
        },
        {
          "type": "text",
          "id": "hotsale",
          "label": "hotsale标识"
        },
        {
          "type": "text",
          "id": "custom_title",
          "label": "自定义标题"
        },
          {
          "type": "text",
          "id": "custom_describe",
          "label": "自定义描述"
        },
         {
          "type": "text",
          "id": "price",
          "label": "定价"
        },
         {
          "type": "text",
          "id": "original",
          "label": "原价"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "按钮标题"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "按钮链接"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "产品推荐",
      "category": "自定义组件",
      "blocks": [
        {
          "type": "card"
        },
        {
          "type": "card"
        },
        {
          "type": "card"
        },
        {
          "type": "card"
        }
      ]
    }
  ]
}
{% endschema %}
