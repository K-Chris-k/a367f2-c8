<style>
  /* Bundle 图片叠加样式 */
  @import url("{{ 'bundle-image-overlay.css' | asset_url }}");
  
  .product__block--price .f-price-item--sale {
    font-size: 24px;
    font-weight: 500;
    background: linear-gradient(180deg, #3250c3, #91affa);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  .product__block--price .f-price-item--regular {
    font-size: 18px;
  }
  .product__tax_new {
    padding: 18px 23px;
    border-radius: 8px;
    background: #ebf1ff;
    color: #666;
  }
  .product__tax_new .title {
    line-height: 17px;
    font-size: 14px;
    font-weight: 700;
  }
  .product__tax_new .content,
  .product__tax_new .taxes-popup .text,
  .product__tax_new .item-content {
    margin-top: 6px;
    line-height: 15px;
    font-size: 12px;
    font-weight: 400;
  }
  .product__tax_new .taxes-popup .text {
    padding-bottom: 13px;
    color: #3250c3;
    text-decoration: underline;
    cursor: pointer;
  }
  .product__tax_new .item-content {
    display: flex;
    align-items: center;
    gap: 4px;
  }
  .drawer__inner .drawer__body p {
    line-height: 26px;
    font-size: 16px;
  }
  .drawer__inner .drawer__body p strong {
    line-height: 36px;
    font-size: 20px;
    font-weight: 500;
  }
  .drawer__inner .drawer__body li {
    position: relative;
    padding-left: 15px;
    margin-top: 8px;
    color: #6a6a6a;
  }
  @media screen and (max-width:749px) {
    .drawer__inner .drawer__body li {
       padding-left: 5px;
    }
  }
  .drawer__inner .drawer__body li::before {
    content: '';
    display: none;
    position: absolute;
    left: 0;
    top: 12px;
    width: 5px;
    height: 5px;
    background-color: currentColor;
    border-radius: 50%;
  }
  .product__info-container .f-price {
    flex-direction: column;
    align-items: baseline;
  }
  .product__info-container .f-price__regular {
    display: none;
  }
  .product__info-container .f-price__sale {
    display: block;
  }
  .product__info-container .discount-label {
    display: flex;
    gap: 4px;
    font-size: 12px;
    padding: 4px 6px;
    border-radius: 2px;
    background-color: #f8200c1a;
    font-weight: 700;
    color: #f8200c;
    line-height: 1.4;
    margin-left: 0;
  }
  .logistics-box {
    padding: 19px 24px;
    border-radius: 20px;
    background: #f3f4f7;
  }
  .logistics-box ul {
    display: grid;
    grid-template-columns: 1fr 1fr;
  }
  .logistics-box li {
    display: inline-flex;
    align-items: center;
    line-height: 35px;
    font-size: 14px;
    color: #6a6a6a;
  }
  .logistics-box li .icon {
    margin-right: 5px;
  }
  .toggle-button {
    margin-top: -15px;
    margin-left: 10px;
    font-size: 14px;
    cursor: pointer;
    color: #3250c3;
  }
  .toggle-button span {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    border-bottom: 1px solid #3250c3;
  }
  .toggle-button .icon-slider-prev {
    transform: rotate(90deg) translateZ(0);
  }
  .toggle-button .icon-slider-next {
    transform: rotate(-90deg) translateZ(0);
    transition: transform 0.15s linear;
  }
  .awards-box {
    background: #f5f5f5;
    padding: 24px 22px;
    display: flex;
    border-radius: 12px;
    justify-content: space-between;
    align-items: center;
  }
  .awards-box .title {
    display: inline-flex;
    gap: 10px;
    align-items: center;
    line-height: 20px;
    font-size: 16px;
    font-weight: 600;
    color: rgba(0, 0, 0, 0.9);
  }
  .awards-box .title .icon {
    width: 2rem;
    height: 2rem;
  }
  .awards-box .awards-image {
    position: relative;
    height: 68px;
  }
  .awards-box .awards-image img {
    object-fit: contain;
    height: 100%;
    width: 100%;
  }
  .koala-element--app-block .LT8hJjx1UAeFLiqVoUvI {
    flex: 0 0 100px;
    width: 100px;
    height: 100px;
    border: none;
  }
  .koala-element--app-block .b2iASJxDqPWUHN9guQKK {
    background: transparent !important;
    border: 1px solid #ef6918 !important;
    border-radius: 6px !important;
  }
  .koala-element--app-block .b2iASJxDqPWUHN9guQKK p {
    font-size: 12px !important;
    color: #ef6918 !important;
  }
  .koala-element--app-block .csAInXlPMgkXbv6vhgn8 {
    flex-flow: column;
    gap: 10px;
  }
  .koala-element--app-block .gJ2_p5A2ywjPL8l4qjqQ {
    align-items: flex-start;
  }
  .koala-element--app-block .oeHfi1XjhGGUNNhlpvwE {
    border-color: #000000 !important;
    {% comment %} box-shadow: 0 0 0 0.5px #2164ff80, inset 0 0 0 0.3px #3250c3; {% endcomment %}
  }
  .koala-element--app-block .hFgFCHQDYtgxUaX_2hPo {
    margin-top: 12px;
    gap: 10px;
  }
  .koala-element--app-block .MuqLpmLxF6jm7LwA9Qbn {
    align-items: start;
  }
  .koala-element--app-block .gJ2_p5A2ywjPL8l4qjqQ strong {
    text-decoration: line-through;
    font-weight: 500 !important;
    font-size: 14px !important;
    color: #666 !important;
  }
  .koala-element--app-block .gJ2_p5A2ywjPL8l4qjqQ span {
    font-size: 16px !important;
    font-weight: 600 !important;
    color: #ef6918 !important;
  }
  .koala-element--app-block .B3Aepq6ToyQcfBd97p__,
  .koala-element--app-block .csAInXlPMgkXbv6vhgn8:hover p {
    text-decoration: none;
    color: #000 !important;
    font-size: 16px !important;
  }
  .koala-element--app-block .gJ2_p5A2ywjPL8l4qjqQ span.YhiegIW96Tomj_5OiqQf {
    display: none;
  }
  #share-modal-app .share-button {
    flex-flow: row-reverse;
    padding: 0px;
    border: none;
  }
  #share-modal-app .share-button:hover {
    background: none;
  }
  #share-modal-app .share-button svg {
    width: 12px;
    height: 12px;
  }
  #shareModal .modal-content {
    width: 43%;
    padding: 20px 20px 30px 20px;
    background: #fff;
  }
  #shareModal .modal-close {
    display: flex;
    justify-content: end;
    width: 100%;
  }
  @media (max-width: 768px) {
    .logistics-box ul {
      display: block;
    }
    .awards-box {
      padding: 12px 10px;
      gap: 5px;
    }
    .awards-box .title {
      line-height: 17px;
      font-size: 14px;
    }
    .awards-box .title .icon {
      width: 1.6rem;
      height: 1.6rem;
    }
    .logistics-ul li {
      width: 100%;
    }
    #shareModal .modal-content {
      width: 90%;
    }
  }
</style>
{%- liquid
  assign product_form_id = 'product-form-' | append: section.id
-%}
<div
  id="ProductInfo-{{ section.id }}"
  data-section="{{ section.id }}"
  data-url="{{ product.url }}"
  class="product__info-container{% if enable_sticky_info %} sticky-element{% endif %}"
>
  <div class="product__blocks accordion-parent">
    {%- for block in section.blocks -%}
      {%- case block.type -%}
        {%- when '@app' -%}
          <div class="product__block--{{ block.type }}">
            {% render block %}
          </div>
        {%- when 'text' -%}
          <div
            class="product__block rte product__block--{{ block.type }}"
            {{ block.shopify_attributes }}
          >
            <p class="product__text inline-richtext m-0{% if block.settings.text_style == 'uppercase' %} text-upper{% elsif block.settings.text_style == 'subtitle' %} text-upper text-subtext{% endif %}">
              {{- block.settings.text -}}
            </p>
          </div>
        {%- when 'title' -%}
          <div
            class="product__block--{{ block.type }}"
            {{ block.shopify_attributes }}
          >
            <h1 class="product__title {{ block.settings.heading_size }}">{{ product.title | escape }}</h1>
            <a href="{{ product.url }}" class="product__title">
              <h2 class="h1">
                {{ product.title | escape }}
              </h2>
            </a>
          </div>
        {%- when 'price' -%}
          <div
            class="product__block--{{ block.type }}"
            {{ block.shopify_attributes }}
          >
            <div id="price-{{ section.id }}" role="status">
              {%- render 'price',
                product: product,
                use_variant: true,
                show_sale_badge: false,
                price_class: 'f-price--large'
              -%}
            </div>
            {%- if product.quantity_price_breaks_configured? -%}
              <div class="volume-pricing-note" id="VolumeNote-{{ section.id }}">
                <span class="text-sm text-subtext">{{ 'products.product.volume_pricing.note' | t }}</span>
              </div>
            {%- endif -%}
            {% comment %}
              <div class="product__tax rte">
                {%- if cart.taxes_included -%}
                  {{ 'products.product.include_taxes' | t }}
                {%- endif -%}
                {%- if shop.shipping_policy.body != blank -%}
                  {{ 'products.product.shipping_policy_html' | t: link: shop.shipping_policy.url }}
                {%- endif -%}
              </div>
            {% endcomment %}
            {%- assign product_form_installment_id = 'product-form-installment-' | append: section.id -%}
            {%- form 'product', product, id: product_form_installment_id, class: 'installment' -%}
              <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
              {{ form | payment_terms }}
            {%- endform -%}
          </div>
        {%- when 'taxs' -%}
          <div class="product__block product__tax_new">
            {%- if block.settings.title -%}
              <h3 class="title">{{ block.settings.title }}</h3>
            {%- endif -%}
            {%- if block.settings.content -%}
              <div class="content">{{ block.settings.content }}</div>
            {% endif %}
            {%- if block.settings.taxs_title != blank and block.settings.taxs_title != blank -%}
              <div class="taxes-popup">
                <div
                  class="text"
                  aria-controls="PopupModal-{{ block.id }}"
                  aria-haspopup="dialog"
                >
                  {{ block.settings.taxs_title }}
                </div>
                <basic-modal id="PopupModal-{{ block.id }}" class="drawer modal" style="--modal-width: 77rem;">
                  <div class="fixed-overlay" aria-controls="PopupModal-{{ block.id }}"></div>
                  <div class="drawer__inner">
                    <button
                      class="drawer__close-btn"
                      aria-controls="PopupModal-{{ block.id }}"
                      aria-label="{{ 'accessibility.close' | t }}"
                    >
                      {% render 'icon-close' %}
                    </button>
                    <div class="drawer__body v-scrollable h-full">
                      {{ block.settings.taxs_popup_content }}
                    </div>
                  </div>
                </basic-modal>
              </div>
            {% endif %}
            {%- if block.settings.heading_1 != blank -%}
              <div class="item-content">
                {%- render 'icon-light', size: 'small' -%}
                {{ block.settings.heading_1 }}
              </div>
            {%- endif -%}
            {%- if block.settings.heading_2 != blank -%}
              <div class="item-content">
                {%- render 'icon-car', size: 'small' -%}
                {{ block.settings.heading_2 }}
              </div>
            {%- endif -%}
          </div>
        {%- when 'awards' %}
          <div class="product__block flex awards-box">
            {%- if block.settings.title != blank -%}
              <div class="title">
                {%- render 'icon-awards', size: 'small' -%}
                {{ block.settings.title }}
              </div>
            {% endif %}
            {%- if block.settings.image_pc != blank -%}
              <div class="awards-image">
                <picture>
                  <!-- 移动端图片 -->
                  <source
                    media="(max-width: 749px)"
                    srcset="
                      {{ block.settings.image_mobile | img_url: '800x' }} 1x,
                      {{ block.settings.image_mobile | img_url: '1600x' }} 2x
                    "
                  >

                  <!-- 桌面端图片 -->
                  <source
                    media="(min-width: 750px)"
                    srcset="
                      {{ block.settings.image_pc | img_url: '1200x' }} 1x,
                      {{ block.settings.image_pc | img_url: '2400x' }} 2x
                    "
                  >

                  <!-- 默认图片 -->
                  <img
                    src="{{ block.settings.image_pc | img_url: '1200x' }}"
                    alt="{{ block.settings.title | escape }}"
                    class="service-image"
                    loading="lazy"
                    width="{{ block.settings.image_pc.width }}"
                    height="{{ block.settings.image_pc.height }}"
                  >
                </picture>
              </div>
            {% endif %}
          </div>
        {%- when 'reviews_list' %}
          {%- if block.settings.title != blank -%}
            {% assign reviews_data = product.metafields.custom.reviews_list.value %}
            {%- if reviews_data and reviews_data.reviews -%}
              {% render 'product-review-list',
                title: block.settings.title,
                more: block.settings.more,
                more_url: block.settings.more_url,
                reviewsList: reviews_data.reviews
              %}
            {% endif %}
          {% endif %}
        {%- when 'inventory' -%}
          <div
            class="product__block product__block--{{ block.type }}{% if block.settings.text_style == 'uppercase' %} text-upper{% elsif block.settings.text_style == 'subtitle' %} text-upper text-subtext{% endif %}{% if product.selected_or_first_available_variant.inventory_management != 'shopify' %} hidden{% endif %}"
            {{ block.shopify_attributes }}
            id="Inventory-{{ section.id }}"
            role="status"
          >
            {%- if product.selected_or_first_available_variant.inventory_management == 'shopify' -%}
              {%- liquid
                assign inventory_quantity = product.selected_or_first_available_variant.inventory_quantity

                if inventory_quantity > 0
                  if inventory_quantity <= block.settings.inventory_threshold
                    assign inventory_status = 'low-stock'
                    if block.settings.show_inventory_quantity
                      if inventory_quantity == 1
                        assign inventory_message = 'products.product.inventory_low_stock_one_item_html' | t: quantity: inventory_quantity
                      else
                        assign inventory_message = 'products.product.inventory_low_stock_many_items_html' | t: quantity: inventory_quantity
                      endif
                    else
                      assign inventory_message = 'products.product.inventory_low_stock' | t
                    endif
                  else
                    assign inventory_status = 'in-stock'
                    if block.settings.show_inventory_quantity
                      assign inventory_message = 'products.product.inventory_in_stock_show_count_html' | t: quantity: inventory_quantity
                    else
                      assign inventory_message = 'products.product.inventory_in_stock' | t
                    endif
                  endif
                else
                  if product.selected_or_first_available_variant.inventory_policy == 'continue'
                    assign inventory_status = 'in-stock'
                    assign inventory_message = 'products.product.inventory_out_of_stock_continue_selling' | t
                  else
                    assign inventory_status = 'out-of-stock'
                    assign inventory_message = 'products.product.inventory_out_of_stock' | t
                  endif
                endif
              %}
              <p class="product__inventory product__inventory--{{ inventory_status }}">
                <span class="product__inventory-icon"></span>
                <span class="product__inventory-text">{{- inventory_message -}}</span>
              </p>
              {%- if inventory_status == 'low-stock' and inventory_quantity < block.settings.inventory_threshold -%}
                <progress-bar
                  class="product__inventory-stock-bar progress-bar"
                  data-value="{{ inventory_quantity }}"
                  data-max="{{ block.settings.inventory_threshold }}"
                ></progress-bar>
              {%- endif -%}
            {%- endif -%}
          </div>
        {%- when 'description' -%}
          {%- if product.description != blank -%}
            <div
              class="product__block product__block--{{ block.type }} rte collapsed product-description"
              {{ block.shopify_attributes }}
              id="descriptionContent"
            >
              {{ product.description }}
            </div>
            <div class="toggle-button" id="toggleButton">
              <span
                >Übersicht
                <svg
                  class="icon icon-slider-prev icon--small"
                  viewBox="0 0 20 20"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path d="M7.5 3.74121L13.75 9.99121L7.5 16.2412" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
              </span>
            </div>
            <script>
              document.addEventListener('DOMContentLoaded', function () {
                const content = document.getElementById('descriptionContent');
                const button = document.getElementById('toggleButton');
                const listItems = content.querySelectorAll('li');

                // 初始状态只显示前3条
                if (listItems.length > 3) {
                  for (let i = 3; i < listItems.length; i++) {
                    listItems[i].style.display = 'none';
                  }
                } else {
                  button.style.display = 'none';
                }

                // 点击按钮切换展开/收起状态
                button.addEventListener('click', function () {
                  if (content.classList.contains('collapsed')) {
                    // 展开所有内容
                    for (let i = 3; i < listItems.length; i++) {
                      listItems[i].style.display = 'list-item';
                    }
                    content.classList.remove('collapsed');
                    button.innerHTML =
                      '<span>Übersicht <svg class="icon icon-slider-next icon--small" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.5 3.74121L13.75 9.99121L7.5 16.2412" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></span>';
                    button.classList.add('expanded');
                  } else {
                    // 收起内容，只显示前3条
                    for (let i = 3; i < listItems.length; i++) {
                      listItems[i].style.display = 'none';
                    }
                    content.classList.add('collapsed');
                    button.innerHTML =
                      '<span>Übersicht <svg class="icon icon-slider-prev icon--small" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.5 3.74121L13.75 9.99121L7.5 16.2412" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></span>';
                    button.classList.remove('expanded');
                  }
                });
              });
            </script>
          {%- endif -%}
        {%- when 'sku' -%}
          <div
            class="product__block product__block--{{ block.type }}{% if product.selected_or_first_available_variant.sku.size == 0 %} hidden{% endif %}"
            id="Sku-{{ section.id }}"
            {{ block.shopify_attributes }}
          >
            <p
              class="product__sku{% if block.settings.text_style == 'uppercase' %} text-upper{% elsif block.settings.text_style == 'subtitle' %} text-upper text-subtext{% endif %}"
              role="status"
            >
              <span class="visually-hidden">{{ 'products.product.sku' | t }}:</span>
              {{- product.selected_or_first_available_variant.sku -}}
            </p>
          </div>
        {%- when 'custom_liquid' -%}
          <div
            class="product__block product__block--{{ block.type }}"
            {{ block.shopify_attributes }}
          >
            {{ block.settings.custom_liquid }}
          </div>
        {%- when 'collapsible_tab' -%}
          <div
            class="product__block product__block--{{ block.type }}"
            {{ block.shopify_attributes }}
          >
            <details
              id="Details-{{ block.id }}-{{ section.id }}"
              class="accordion-details"
              is="accordion-group"
              {% if block.settings.default_open %}
                open
                aria-expanded="true"
              {% else %}
                aria-expanded="false"
              {% endif %}
            >
              <summary class="accordion-details__summary flex items-center justify-between">
                <div class="flex items-center gap-2">
                  {% render 'icons', icon: block.settings.icon %}
                  <h2 class="h4 inline-richtext">
                    {{ block.settings.heading | default: block.settings.page.title | escape }}
                  </h2>
                </div>
                {%- render 'icon-plus-toggle' -%}
              </summary>
              <div class="accordion-details__content rte">
                {{ block.settings.content }}
                {{ block.settings.custom_liquid }}
                {{ block.settings.page.content }}
              </div>
            </details>
          </div>
        {%- when 'popup' -%}
          <div
            class="product__block product__block--{{ block.type }}"
            {{ block.shopify_attributes }}
          >
            <button
              class="btn--underline"
              aria-controls="PopupModal-{{ block.id }}"
              aria-haspopup="dialog"
            >
              {{ block.settings.text | default: block.settings.page.title | escape }}
            </button>
            <basic-modal id="PopupModal-{{ block.id }}" class="drawer modal" style="--modal-width: 77rem;">
              <div class="fixed-overlay" aria-controls="PopupModal-{{ block.id }}"></div>
              <div class="drawer__inner">
                <button
                  class="drawer__close-btn"
                  aria-controls="PopupModal-{{ block.id }}"
                  aria-label="{{ 'accessibility.close' | t }}"
                >
                  {% render 'icon-close' %}
                </button>
                <div class="drawer__body v-scrollable h-full">
                  <h1 class="h2">{{ block.settings.page.title | escape }}</h1>
                  {{ block.settings.page.content }}
                </div>
              </div>
            </basic-modal>
          </div>
        {%- when 'addons' -%}
          {%- if block.settings.show_share or block.settings.show_ask_question -%}
            <div
              class="product__block--{{ block.type }} flex items-center"
              {{ block.shopify_attributes }}
            >
              {%- if block.settings.show_share -%}
                <script src="{{ 'product-share.js' | asset_url }}" defer="defer"></script>
                {%- liquid
                  assign share_modal_id = 'PopupModal-Sharing-' | append: section.id
                  assign share_url = product.selected_or_first_available_variant.url | default: product.url | prepend: request.origin
                -%}
                <button
                  class="btn btn--with-icon btn--plain"
                  aria-controls="{{ share_modal_id }}"
                  aria-haspopup="dialog"
                >
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 20 20"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                    aria-hidden="true"
                    focusable="false"
                    role="presentation"
                    class="rtl-flip-x"
                  >
                    <path d="M2.4168 15.525C3.70274 14.1555 7.07852 11.25 11.8754 11.25V15L18.1254 8.75L11.8754 2.5V6.25C7.7504 6.25 2.46212 10.1914 1.8754 15.2766C1.86728 15.3424 1.88032 15.4091 1.91265 15.4671C1.94498 15.525 1.99491 15.5712 2.05522 15.5988C2.11552 15.6265 2.18307 15.6343 2.24807 15.621C2.31308 15.6077 2.37218 15.5741 2.4168 15.525Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <span class="font-body text-normal tracking-normal">
                    {{- 'products.product.share_label' | t -}}
                  </span>
                </button>
                <basic-modal id="{{ share_modal_id }}" class="drawer modal">
                  <div class="fixed-overlay" aria-controls="{{ share_modal_id }}"></div>
                  <div class="drawer__inner">
                    <button
                      class="drawer__close-btn"
                      aria-controls="{{ share_modal_id }}"
                      aria-label="{{ 'accessibility.close' | t }}"
                    >
                      {% render 'icon-close' %}
                    </button>
                    <div class="drawer__body v-scrollable h-full">
                      <div class="product__sharing">
                        <h3 class="product__sharing--title h5">{{ 'products.product.share' | t }}</h3>
                        <product-share class="product__sharing--inputs" id="ProductShare-{{ section.id }}">
                          <label for="ProductShare-{{ section.id }}" class="visually-hidden">
                            {{- 'products.product.share_label' | t -}}
                          </label>
                          <input
                            id="ProductShare-{{ section.id }}"
                            type="text"
                            class="form-control"
                            value="{{ share_url }}"
                            readonly
                          >
                          <button class="btn btn-copy" data-copied-text="{{ 'general.share.copied' | t }}">
                            {{ 'general.share.copy' | t }}
                          </button>
                        </product-share>
                        {% render 'social-sharing',
                          url: product.url,
                          share_image: product.featured_media.preview_image
                        %}
                      </div>
                    </div>
                  </div>
                </basic-modal>
              {%- endif -%}
              {%- if block.settings.show_ask_question -%}
                {%- assign ask_question_modal_id = 'PopupModal-AskQuestionForm-' | append: section.id -%}
                <button
                  class="btn btn--with-icon btn--plain"
                  aria-controls="{{ ask_question_modal_id }}"
                  aria-haspopup="dialog"
                >
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 20 20"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                    aria-hidden="true"
                    focusable="false"
                    role="presentation"
                  >
                    <path d="M10 15C10.5178 15 10.9375 14.5803 10.9375 14.0625C10.9375 13.5447 10.5178 13.125 10 13.125C9.48223 13.125 9.0625 13.5447 9.0625 14.0625C9.0625 14.5803 9.48223 15 10 15Z" fill="currentColor"/>
                    <path d="M10 11.25V10.625C11.3805 10.625 12.5 9.64531 12.5 8.4375C12.5 7.22969 11.3805 6.25 10 6.25C8.61953 6.25 7.5 7.22969 7.5 8.4375V8.75" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M10 17.5C14.1421 17.5 17.5 14.1421 17.5 10C17.5 5.85786 14.1421 2.5 10 2.5C5.85786 2.5 2.5 5.85786 2.5 10C2.5 14.1421 5.85786 17.5 10 17.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <span class="font-body text-normal tracking-normal">
                    {{- 'products.product.question_form.label' | t -}}
                  </span>
                </button>
                <basic-modal id="{{ ask_question_modal_id }}" class="drawer modal">
                  <div class="fixed-overlay" aria-controls="{{ ask_question_modal_id }}"></div>
                  <div class="drawer__inner">
                    <button
                      class="drawer__close-btn"
                      aria-controls="{{ ask_question_modal_id }}"
                      aria-label="{{ 'accessibility.close' | t }}"
                    >
                      {% render 'icon-close' %}
                    </button>
                    <div class="drawer__body v-scrollable h-full">
                      {% render 'ask-question-form' %}
                    </div>
                  </div>
                </basic-modal>
              {%- endif -%}
            </div>
          {%- endif -%}
        {%- when 'variant_picker' -%}
          {%- liquid
            # 优先级1: 检查是否有 bundle_products block 配置
            assign bundle_config_block = null
            if section.blocks
              for block_item in section.blocks
                if block_item.type == 'bundle_products'
                  assign bundle_config_block = block_item
                  break
                endif
              endfor
            endif
          -%}
          
          {%- if bundle_config_block != null -%}
            {%- comment -%} 使用 block 配置方式（关联产品通过 block 选择，渲染通过 Metafields） {%- endcomment -%}
            <div
              class="product__block product__block--{{ block.type }}"
              {{ block.shopify_attributes }}
            >
              {%- render 'product-variant-picker-block-metafields',
                product: product,
                block: block,
                product_form_id: product_form_id,
                update_url: update_url,
                section: section,
                bundle_config_block: bundle_config_block
              -%}
            </div>
          {%- elsif product.metafields.custom.akku_erweiterung != blank -%}
            {%- comment -%} 优先级2: akku_erweiterung metafield（保持原有逻辑） {%- endcomment -%}
            {% render 'combo-options', product: product %}
            {% comment %}
              {% render 'product-variant-picker',
                product: product,
                block: block,
                product_form_id: product_form_id,
                update_url: update_browser_history
              %}
            {% endcomment %}
          {%- elsif product.metafields.custom.variant_display_config != blank -%}
            {%- comment -%} 优先级3: variant_display_config metafield {%- endcomment -%}
            {%- liquid
              # 检查是否有至少一个选项有配置
              assign variant_config = product.metafields.custom.variant_display_config.value
              assign has_configured_option = false

              if variant_config and variant_config.options
                for option in product.options_with_values
                  for opt_cfg in variant_config.options
                    if opt_cfg.name == option.name and opt_cfg.display_type
                      assign has_configured_option = true
                      break
                    endif
                  endfor
                  if has_configured_option
                    break
                  endif
                endfor
              endif
            -%}
            {%- if has_configured_option -%}
              <div
                class="product__block product__block--{{ block.type }}"
                {{ block.shopify_attributes }}
              >
                {%- render 'product-variant-picker-metafields',
                  product: product,
                  block: block,
                  product_form_id: product_form_id,
                  update_url: update_url,
                  section: section
                -%}
              </div>
            {%- else -%}
              {%- comment -%} variant_display_config 存在但没有配置任何选项，使用标准渲染 {%- endcomment -%}
              <div
                class="product__block product__block--{{ block.type }}"
                {{ block.shopify_attributes }}
              >
                {% render 'product-variant-picker',
                  product: product,
                  block: block,
                  product_form_id: product_form_id,
                  update_url: update_browser_history
                %}
              </div>
            {%- endif -%}
          {%- else -%}
            {%- comment -%} 优先级4: 标准渲染（没有任何配置） {%- endcomment -%}
            <div
              class="product__block product__block--{{ block.type }}"
              {{ block.shopify_attributes }}
            >
              {% render 'product-variant-picker',
                product: product,
                block: block,
                product_form_id: product_form_id,
                update_url: update_browser_history
              %}
            </div>
          {%- endif -%}
           {%- when 'cross_sell_products' -%}
          <div
            class="product__block product__block--{{ block.type }} cross-sell-products-block"
            {{ block.shopify_attributes }}
          >
            {%- if block.settings.title != blank -%}
              <h3 class="cross-sell-title">{{ block.settings.title }}</h3>
            {%- endif -%}
            <div class="cross-sell-products-list">
              {%- assign cross_sell_products = '' | split: ',' -%}
              {%- if block.settings.cross_sell_product_1 != blank -%}
                {%- assign cross_sell_products = cross_sell_products | concat: block.settings.cross_sell_product_1 | split: '|||' -%}
              {%- endif -%}
              {%- if block.settings.cross_sell_product_2 != blank -%}
                {%- assign cross_sell_products = cross_sell_products | concat: block.settings.cross_sell_product_2 | split: '|||' -%}
              {%- endif -%}
              {%- if block.settings.cross_sell_product_3 != blank -%}
                {%- assign cross_sell_products = cross_sell_products | concat: block.settings.cross_sell_product_3 | split: '|||' -%}
              {%- endif -%}
              {%- if block.settings.cross_sell_product_4 != blank -%}
                {%- assign cross_sell_products = cross_sell_products | concat: block.settings.cross_sell_product_4 | split: '|||' -%}
              {%- endif -%}
              
              {%- for i in (1..4) -%}
                {%- assign product_setting_key = 'cross_sell_product_' | append: i -%}
                {%- assign default_setting_key = 'cross_sell_product_' | append: i | append: '_default' -%}
                {%- assign cross_product = block.settings[product_setting_key] -%}
                {%- assign is_default_selected = block.settings[default_setting_key] -%}
                {%- if cross_product != blank -%}
                  {%- assign variant = cross_product.selected_or_first_available_variant -%}
                  {%- capture cross_sell_variants_json -%}
                  [
                    {%- for v in cross_product.variants -%}
                      {
                        "id": {{ v.id }},
                        "title": "{{ v.title | escape }}",
                        "price": {{ v.price }},
                        "compare_at_price": {{ v.compare_at_price | default: v.price }},
                        "available": {{ v.available | json }},
                        "image": "{% if v.featured_image %}{{ v.featured_image | image_url: width: 200 }}{% endif %}"
                      }{% unless forloop.last %},{% endunless %}
                    {%- endfor -%}
                  ]
                  {%- endcapture -%}
                  <div 
                    class="cross-sell-product-card{% if is_default_selected %} selected{% endif %}"
                    data-variant-id="{{ variant.id }}"
                    data-product-id="{{ cross_product.id }}"
                    data-product-title="{{ cross_product.title | escape }}"
                    data-default-image="{% if cross_product.featured_image %}{{ cross_product.featured_image | image_url: width: 200 }}{% endif %}"
                    data-price="{{ variant.price }}"
                    data-compare-price="{{ variant.compare_at_price | default: variant.price }}"
                    data-variants="{{ cross_sell_variants_json | strip_newlines | escape }}"
                  >
                    <div class="cross-sell-checkbox-wrapper">
                      <input 
                        type="checkbox" 
                        class="cross-sell-checkbox" 
                        id="cross-sell-{{ block.id }}-{{ i }}"
                        data-variant-id="{{ variant.id }}"
                        {% if is_default_selected %}checked{% endif %}
                      >
                      <label for="cross-sell-{{ block.id }}-{{ i }}" class="cross-sell-checkbox-label">
                        <span class="cross-sell-checkbox-custom"></span>
                      </label>
                    </div>
                    <div class="cross-sell-product-image">
                      {%- if cross_product.featured_image != blank -%}
                        <img 
                          src="{{ cross_product.featured_image | image_url: width: 120 }}" 
                          alt="{{ cross_product.title | escape }}"
                          width="60"
                          height="60"
                          loading="lazy"
                        >
                      {%- else -%}
                        {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
                      {%- endif -%}
                    </div>
                    <div class="cross-sell-product-content">
                      <h4 class="cross-sell-product-title">{{ cross_product.title }}</h4>
                      {%- if cross_product.variants.size > 1 -%}
                        <div class="cross-sell-variant-select">
                          <select class="cross-sell-variant-dropdown">
                            {%- for v in cross_product.variants -%}
                              <option 
                                value="{{ v.id }}"
                                data-price="{{ v.price }}"
                                data-compare="{{ v.compare_at_price | default: v.price }}"
                                data-image="{% if v.featured_image %}{{ v.featured_image | image_url: width: 200 }}{% endif %}"
                                {% if v.id == variant.id %}selected{% endif %}
                              >
                                {{ v.title }}
                              </option>
                            {%- endfor -%}
                          </select>
                        </div>
                      {%- endif -%}
                      <div class="cross-sell-product-bottom">
                        <div class="cross-sell-quantity-wrapper">
                          <button type="button" class="cross-sell-qty-btn cross-sell-qty-minus" aria-label="Decrease quantity">
                            <span>−</span>
                          </button>
                          <input 
                            type="number" 
                            class="cross-sell-qty-input" 
                            value="1" 
                            min="1" 
                            max="99"
                            data-variant-id="{{ variant.id }}"
                          >
                          <button type="button" class="cross-sell-qty-btn cross-sell-qty-plus" aria-label="Increase quantity">
                            <span>+</span>
                          </button>
                        </div>
                        <div class="cross-sell-product-price">
                          <span class="cross-sell-price">{{ variant.price | money }}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                {%- endif -%}
              {%- endfor -%}
            </div>
          </div>
          <style>
            .cross-sell-products-block {
              margin-top: 20px;
            }
            .cross-sell-title {
              font-size: 20px;
              font-weight: 600;
              margin-bottom: 16px;
              color: #000;
            }

            .cross-sell-products-list {
              display: flex;
              flex-direction: column;
              gap: 12px;
            }
            .cross-sell-product-card {
              display: flex;
              align-items: flex-start;
              gap: 12px;
              padding: 16px;
              border: 1.5px solid #e5e5e5;
              border-radius: 12px;
              background: #fff;
              transition: border-color 0.2s ease, box-shadow 0.2s ease;
              cursor: pointer;
            }
            .cross-sell-product-card.selected {
              border-color: #3250c3 !important;
              box-shadow: 0 0 0 .5px #2164ff80, inset 0 0 0 .3px #3250c3;
            }
            .cross-sell-checkbox-wrapper {
              position: relative;
              flex-shrink: 0;
              padding-top: 4px;
            }
            .cross-sell-checkbox {
              position: absolute;
              opacity: 0;
              width: 0;
              height: 0;
            }
            .cross-sell-checkbox-label {
              display: block;
              cursor: pointer;
            }
            .cross-sell-checkbox-custom {
              display: flex;
              align-items: center;
              justify-content: center;
              width: 18px;
              height: 18px;
              border: 1px solid #ccc;
              border-radius: 4px;
              background: #fff;
              transition: all 0.2s ease;
            }
            .cross-sell-checkbox:checked + .cross-sell-checkbox-label .cross-sell-checkbox-custom {
              background: #3250c3;
              border-color: #3250c3;
            }
            .cross-sell-checkbox:checked + .cross-sell-checkbox-label .cross-sell-checkbox-custom::after {
              content: '';
              display: block;
              width: 6px;
              height: 10px;
              border: solid #fff;
              border-width: 0 2px 2px 0;
              transform: rotate(45deg);
              margin-bottom: 2px;
            }
            .cross-sell-product-image {
              flex-shrink: 0;
              width: 65px;
              height: 65px;
              overflow: hidden;
            }
            .cross-sell-product-image img {
              width: 100%;
              height: 100%;
              object-fit: contain;
            }
            .cross-sell-product-content {
              flex: 1;
              min-width: 0;
              display: flex;
              flex-direction: column;
              gap: 8px;
            }
            .cross-sell-product-title {
              font-size: 14px;
              font-weight: 500;
              color: #1a1a1a;
              margin: 0;
              line-height: 1.4;
            }
            .cross-sell-variant-select {
              max-width: 140px;
            }
            .cross-sell-variant-dropdown {
              width: 100%;
              padding: 6px 8px;
              border: 1px solid #e5e5e5;
              border-radius: 6px;
              font-size: 13px;
            }
            .cross-sell-product-bottom {
              display: flex;
              align-items: center;
              justify-content: space-between;
              gap: 12px;
            }
            .cross-sell-quantity-wrapper {
              display: inline-flex;
              align-items: center;
              border: 1px solid #e5e5e5;
              border-radius: 6px;
              overflow: hidden;
            }
            .cross-sell-qty-btn {
              display: flex;
              align-items: center;
              justify-content: center;
              width: 28px;
              height: 28px;
              border: none;
              background: #fff;
              color: #666;
              font-size: 16px;
              cursor: pointer;
              transition: background 0.2s ease;
            }
            .cross-sell-qty-btn:hover {
              background: #f5f5f5;
            }
            .cross-sell-qty-input {
              width: 32px;
              height: 28px;
              border: none;
              border-left: 1px solid #e5e5e5;
              border-right: 1px solid #e5e5e5;
              text-align: center;
              font-size: 14px;
              -moz-appearance: textfield;
            }
            .cross-sell-qty-input::-webkit-outer-spin-button,
            .cross-sell-qty-input::-webkit-inner-spin-button {
              -webkit-appearance: none;
              margin: 0;
            }
            .cross-sell-product-price {
              flex-shrink: 0;
              text-align: right;
            }
            .cross-sell-price {
              font-size: 16px;
              font-weight: 600;
              color: #1a1a1a;
            }
            @media screen and (max-width: 749px) {
              .cross-sell-product-card {
                padding: 12px;
              }
              .cross-sell-product-title {
                font-size: 13px;
              }
              .cross-sell-product-image {
                width: 50px;
                height: 50px;
              }
            }
          </style>
          <script>
            (function() {
              function formatMoney(cents) {
                if (window.FoxTheme?.Currency?.formatMoney) {
                  return window.FoxTheme.Currency.formatMoney(cents, window.FoxTheme.settings.moneyFormat);
                }
                return (cents / 100).toFixed(2);
              }

              function initCrossSellProducts() {
                const cards = document.querySelectorAll('.cross-sell-product-card');
                cards.forEach(card => {
                  const checkbox = card.querySelector('.cross-sell-checkbox');
                  const minusBtn = card.querySelector('.cross-sell-qty-minus');
                  const plusBtn = card.querySelector('.cross-sell-qty-plus');
                  const qtyInput = card.querySelector('.cross-sell-qty-input');
                  const variantDropdown = card.querySelector('.cross-sell-variant-dropdown');
                  const priceEl = card.querySelector('.cross-sell-price');
                  const imageEl = card.querySelector('.cross-sell-product-image img');
                  const titleEl = card.querySelector('.cross-sell-product-title');
                  const productTitle = card.dataset.productTitle || '';
                  const defaultImage = card.dataset.defaultImage || (imageEl?.getAttribute('src') || '');

                  let variants = [];
                  try {
                    variants = card.dataset.variants ? JSON.parse(card.dataset.variants) : [];
                  } catch (e) {
                    variants = [];
                  }

                  function applyVariant(variantId) {
                    if (!variants.length) return;
                    const variant = variants.find(v => String(v.id) === String(variantId)) || variants[0];
                    if (!variant) return;

                    card.dataset.variantId = variant.id;
                    card.dataset.price = variant.price;
                    card.dataset.comparePrice = variant.compare_at_price || variant.price;

                    if (priceEl) {
                      priceEl.textContent = formatMoney(variant.price);
                    }

                    if (imageEl) {
                      if (variant.image) {
                        imageEl.src = variant.image;
                      } else if (defaultImage) {
                        imageEl.src = defaultImage;
                      }
                    }

                    if (titleEl) {
                      const variantLabel = variant.title && variant.title !== 'Default Title' ? ` - ${variant.title}` : '';
                      titleEl.textContent = `${productTitle}${variantLabel}`;
                    }

                    if (qtyInput) {
                      qtyInput.dataset.variantId = variant.id;
                    }
                    if (checkbox) {
                      checkbox.dataset.variantId = variant.id;
                    }

                    triggerCrossSellPriceUpdate();
                  }

                  if (variantDropdown) {
                    // 阻止冒泡，避免点击下拉时触发卡片选中
                    variantDropdown.addEventListener('mousedown', e => e.stopPropagation());
                    variantDropdown.addEventListener('click', e => e.stopPropagation());
                    variantDropdown.addEventListener('change', function(e) {
                      e.stopPropagation();
                      applyVariant(this.value);
                    });
                    applyVariant(variantDropdown.value);
                  } else if (variants.length) {
                    applyVariant(card.dataset.variantId || variants[0].id);
                  }
                  
                  checkbox.addEventListener('change', function() {
                    if (this.checked) {
                      card.classList.add('selected');
                    } else {
                      card.classList.remove('selected');
                    }
                    triggerCrossSellPriceUpdate();
                  });
                  
                  minusBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    let qty = parseInt(qtyInput.value) || 1;
                    if (qty > 1) {
                      qtyInput.value = qty - 1;
                      triggerCrossSellPriceUpdate();
                    }
                  });
                  
                  plusBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    let qty = parseInt(qtyInput.value) || 1;
                    if (qty < 99) {
                      qtyInput.value = qty + 1;
                      triggerCrossSellPriceUpdate();
                    }
                  });
                  
                  qtyInput.addEventListener('change', function() {
                    let qty = parseInt(this.value) || 1;
                    if (qty < 1) qty = 1;
                    if (qty > 99) qty = 99;
                    this.value = qty;
                    triggerCrossSellPriceUpdate();
                  });
                  
                  card.addEventListener('click', function(e) {
                    if (e.target.closest('.cross-sell-quantity-wrapper') || 
                        e.target.closest('.cross-sell-checkbox-wrapper') ||
                        e.target.closest('.cross-sell-variant-select')) {
                      return;
                    }
                    checkbox.checked = !checkbox.checked;
                    checkbox.dispatchEvent(new Event('change'));
                  });
                });
                
                setTimeout(() => {
                  triggerCrossSellPriceUpdate();
                }, 100);
              }
              
              function getCrossSellTotalInCents() {
                let crossSellTotal = 0;
                document.querySelectorAll('.cross-sell-product-card').forEach(card => {
                  const checkbox = card.querySelector('.cross-sell-checkbox');
                  if (checkbox && checkbox.checked) {
                    const price = parseFloat(card.dataset.price) || 0;
                    const qtyInput = card.querySelector('.cross-sell-qty-input');
                    const qty = parseInt(qtyInput?.value || '1', 10);
                    crossSellTotal += price * qty;
                  }
                });
                
                return crossSellTotal;
              }
              
              function triggerCrossSellPriceUpdate() {
                const bundleConfigEl = document.querySelector('[id^="BundleProductsConfig-"]');
                if (bundleConfigEl) {
                  document.dispatchEvent(new CustomEvent('crosssell:change', {
                    detail: { totalInCents: getCrossSellTotalInCents() }
                  }));
                  
                  if (window.bundleProducts && typeof window.bundleProducts.updatePrice === 'function') {
                    window.bundleProducts.updatePrice();
                  }
                } else {
                   //  发现价格会叠加2次  所以注释了用的上面一样的方法
                  //updateStickyBarWithCrossSell(getCrossSellTotalInCents());
                  window.bundleProducts.updatePrice();
                }
              }
              
              function updateStickyBarWithCrossSell(crossSellTotalInCents) {
                const priceContainer = document.querySelector('.product__info-container');
                let originalPrice = 0;
                if (priceContainer && priceContainer.dataset.originalPrice) {
                  originalPrice = parseFloat(priceContainer.dataset.originalPrice);
                } else {
                  const salePriceEl = priceContainer?.querySelector('.f-price-item--sale');
                  const regularPriceEl = priceContainer?.querySelector('.f-price-item--regular');
                  const mainPriceText = salePriceEl?.textContent || regularPriceEl?.textContent || '0';
                  originalPrice = parseFloat(
                    mainPriceText
                      .replace(/[^\d,]/g, '')
                      .replace(',', '.')
                  ) || 0;
                  
                  if (priceContainer) {
                    priceContainer.dataset.originalPrice = originalPrice;
                  }
                }
                
                let lookbookTotal = 0;
                document.querySelectorAll('.lb-select-on-click[lb-selected]').forEach(card => {
                  const priceEl = card.querySelector('.lb-price-sale-price');
                  const price = priceEl ? parseFloat(
                    priceEl.textContent.trim()
                      .replace(/[^\d,]/g, '')
                      .replace(',', '.')
                  ) || 0 : 0;
                  const qtyInput = card.querySelector('input.lb-qty-count');
                  const qty = qtyInput ? parseInt(qtyInput.value || '1', 10) : 1;
                  lookbookTotal += price * qty;
                });
                
                const finalTotal = originalPrice + (crossSellTotalInCents / 100) + lookbookTotal;
                const parts = finalTotal.toFixed(2).split('.');
                const integerPart = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, '.');
                const formattedPrice = integerPart + ',' + parts[1] + ' €';
                const mainSalePrice = priceContainer?.querySelector('.f-price-item--sale');
                if (mainSalePrice) {
                  mainSalePrice.textContent = formattedPrice;
                }
                
                const stickyContainer = document.querySelector('.sticky-atc-bar__inner .product-price-box');
                const stickyPrice = stickyContainer?.querySelector('.f-price-item--sale') ||
                                    stickyContainer?.querySelector('.f-price-item--regular');
                
                if (stickyPrice) {
                  stickyPrice.textContent = formattedPrice;
                }
              }
              
              window.getCrossSellSelectedProducts = function() {
                const items = [];
                document.querySelectorAll('.cross-sell-product-card').forEach(card => {
                  const checkbox = card.querySelector('.cross-sell-checkbox');
                  if (checkbox && checkbox.checked) {
                    const variantId = card.dataset.variantId;
                    const qtyInput = card.querySelector('.cross-sell-qty-input');
                    const qty = parseInt(qtyInput?.value || '1', 10);
                    if (variantId && qty > 0) {
                      items.push({ id: parseInt(variantId), quantity: qty });
                    }
                  }
                });
                return items;
              };
              
              window.getCrossSellTotalInCents = getCrossSellTotalInCents;
              window.updateCrossSellTotalPrice = triggerCrossSellPriceUpdate;
              if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initCrossSellProducts);
              } else {
                initCrossSellProducts();
              }
            })();
          </script>
        {%- when 'free_gift_products' -%}
          <div
            class="product__block product__block--{{ block.type }} free-gift-products-block"
            {{ block.shopify_attributes }}
            data-main-product-id="{{ product.id }}"
            data-main-variant-id="{{ product.selected_or_first_available_variant.id }}"
            data-max-selections="{{ block.settings.max_selections | default: 1 }}"
          >
            {%- if block.settings.title != blank -%}
              <h3 class="free-gift-title">{{ block.settings.title }}</h3>
            {%- endif -%}
            {%- if block.settings.max_selection_message != blank -%}
              <div class="free-gift-max-message" style="display: none;" 
                   data-message-template="{{ block.settings.max_selection_message | escape }}" 
                   data-max-count="{{ block.settings.max_selections | default: 1 }}">
              </div>
            {%- endif -%}
            <div class="free-gift-products-list">
              {%- for i in (1..4) -%}
                {%- assign product_setting_key = 'free_product_' | append: i -%}
                {%- assign default_setting_key = 'free_product_' | append: i | append: '_default' -%}
                {%- assign free_variant_key = 'free_product_' | append: i | append: '_variant' -%}
                {%- assign custom_price_key = 'free_product_' | append: i | append: '_custom_price' -%}
                {%- assign free_product = block.settings[product_setting_key] -%}
                {%- assign is_default_selected = block.settings[default_setting_key] -%}
                {%- assign free_variant_id = block.settings[free_variant_key] -%}
                {%- assign custom_price = block.settings[custom_price_key] -%}
                {%- assign free_label_text = block.settings.free_label_text | default: "GRATIS" -%}
                {%- if free_product != blank -%}
                  {%- assign variant = free_product.selected_or_first_available_variant -%}
                  {%- assign cart_variant_id = free_variant_id | default: variant.id -%}
                  <div 
                    class="free-gift-product-card{% if is_default_selected %} selected{% endif %}"
                    data-variant-id="{{ cart_variant_id }}"
                    data-display-variant-id="{{ variant.id }}"
                    data-product-id="{{ free_product.id }}"
                    data-product-handle="{{ free_product.handle }}"
                    data-original-price="{{ variant.price }}"
                  >
                    <div class="free-gift-checkbox-wrapper">
                      <input 
                        type="checkbox" 
                        class="free-gift-checkbox" 
                        id="free-gift-{{ block.id }}-{{ i }}"
                        data-variant-id="{{ cart_variant_id }}"
                        {% if is_default_selected %}checked{% endif %}
                      >
                      <label for="free-gift-{{ block.id }}-{{ i }}" class="free-gift-checkbox-label">
                        <span class="free-gift-checkbox-custom"></span>
                      </label>
                    </div>
                    <div class="free-gift-product-image">
                      {%- if free_product.featured_image != blank -%}
                        <img 
                          src="{{ free_product.featured_image | image_url: width: 120 }}" 
                          alt="{{ free_product.title | escape }}"
                          width="60"
                          height="60"
                          loading="lazy"
                        >
                      {%- else -%}
                        {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
                      {%- endif -%}
                    </div>
                    <div class="free-gift-product-content">
                      <h4 class="free-gift-product-title">{{ free_product.title| split: '(' | first | strip }}</h4>
                    </div>
                    <div class="free-gift-product-price">
                      <span class="free-gift-price-free">{{ free_label_text }}</span>
                      {% comment %} <span class="free-gift-price-original">
                        {%- if custom_price != blank -%}
                          {{ custom_price }}
                        {%- else -%}
                          {{ variant.price | money }}
                        {%- endif -%}
                      </span> {% endcomment %}
                    </div>
                  </div>
                {%- endif -%}
              {%- endfor -%}
            </div>
          </div>
          <style>
            .free-gift-products-block {
              margin-top: 20px;
            }
            .free-gift-title {
              font-size: 20px;
              font-weight: 600;
              margin-bottom: 16px;
              color: #000;
            }
            .free-gift-max-message {
              padding: 12px 16px;
              margin-bottom: 12px;
              background: #fff3cd;
              border: 1px solid #ffc107;
              border-radius: 8px;
              color: #856404;
              font-size: 14px;
              line-height: 1.4;
            }
            .free-gift-products-list {
              display: flex;
              flex-direction: column;
              gap: 12px;
            }
            .free-gift-product-card {
              display: flex;
              align-items: center;
              justify-content: center;
              gap: 12px;
              padding: 16px;
              border: 1.5px solid #e5e5e5;
              border-radius: 12px;
              background: #fff;
              transition: border-color 0.2s ease, box-shadow 0.2s ease;
              cursor: pointer;
            }
            .free-gift-product-card.selected {
              border-color: #3250c3 !important;
              box-shadow: 0 0 0 .5px #2164ff80, inset 0 0 0 .3px #3250c3;
            }
            .free-gift-checkbox-wrapper {
              position: relative;
              flex-shrink: 0;
            }
            .free-gift-checkbox {
              position: absolute;
              opacity: 0;
              width: 0;
              height: 0;
            }
            .free-gift-checkbox-label {
              display: block;
              cursor: pointer;
            }
            .free-gift-checkbox-custom {
              display: flex;
              align-items: center;
              justify-content: center;
              width: 22px;
              height: 22px;
              border: 2px solid #ccc;
              border-radius: 9999px;
              background: #fff;
              transition: all 0.2s ease;
            }
            .free-gift-checkbox:checked + .free-gift-checkbox-label .free-gift-checkbox-custom {
              background: #3250c3;
              border-color: #3250c3;
            }
            .free-gift-checkbox:checked + .free-gift-checkbox-label .free-gift-checkbox-custom::after {
              content: '';
              display: block;
              width: 6px;
              height: 10px;
              border: solid #fff;
              border-width: 0 2px 2px 0;
              transform: rotate(45deg);
              margin-bottom: 2px;
            }
            .free-gift-product-image {
              flex-shrink: 0;
              width: 65px;
              height: 65px;
              overflow: hidden;
            }
            .free-gift-product-image img {
              width: 100%;
              height: 100%;
              object-fit: contain;
            }
            .free-gift-product-content {
              flex: 1;
              min-width: 0;
              display: flex;
              align-items: center;
              justify-content: left:
            }
            .free-gift-product-title {
              font-size: 14px;
              font-weight: 500;
              color: #1a1a1a;
              margin: 0;
              line-height: 1.4;
            }
            .free-gift-product-price {
              flex-shrink: 0;
              text-align: right;
              display: flex;
              flex-direction: row;
              align-items: center;
              gap: 8px;
            }
            .free-gift-price-free {
              font-size: 20px;
              font-weight: 600;
              color: #000;
            }
            .free-gift-price-original {
              font-size: 18px;
              color: #999;
              text-decoration: line-through;
            }
            .free-gift-checkbox {
            display: none !important;

              }
            @media screen and (max-width: 749px) {
              .free-gift-product-card {
                padding: 12px;
              }
              .free-gift-product-title {
                font-size: 13px;
              }
              .free-gift-product-image {
                width: 50px;
                height: 50px;
              }
              .free-gift-price-free {
              font-size: 16px;
              font-weight: 600;
              color: #000;
            }
            .free-gift-price-original {
              font-size: 14px;
              color: #999;
              text-decoration: line-through;
            }
            }
          </style>
          <script>
            (function() {
                // Free Gift Products functionality - 单选模式
              const mainProductId = '{{ product.id }}';
              const mainVariantId = '{{ product.selected_or_first_available_variant.id }}';
              
              function initFreeGiftProducts() {
                const cards = document.querySelectorAll('.free-gift-product-card');
                const blockEl = document.querySelector('.free-gift-products-block');
                const maxSelections = parseInt(blockEl?.dataset.maxSelections || '1', 10);
                const messageEl = document.querySelector('.free-gift-max-message');
                let messageTimeout;
                
                // 显示超出限制提示
                function showMaxMessage() {
                  if (!messageEl) return;
                  
                  const template = messageEl.dataset.messageTemplate || '';
                  const maxCount = messageEl.dataset.maxCount || maxSelections;
                  const message = template.replace(/\{count\}/g, maxCount);
                  
                  messageEl.textContent = message;
                  messageEl.style.display = 'block';
                  
                  if (messageTimeout) clearTimeout(messageTimeout);
                  
                  messageTimeout = setTimeout(() => {
                    messageEl.style.display = 'none';
                  }, 3000);
                }
                
                cards.forEach(card => {
                  const checkbox = card.querySelector('.free-gift-checkbox');
                  
                  checkbox.addEventListener('change', function() {
                    if (this.checked) {
                      // 如果是单选模式（maxSelections=1），取消其他所有选择
                      if (maxSelections === 1) {
                        document.querySelectorAll('.free-gift-checkbox').forEach(cb => {
                          if (cb !== this) {
                            cb.checked = false;
                            cb.closest('.free-gift-product-card').classList.remove('selected');
                          }
                        });
                      } else {
                        // 多选模式：检查是否超过最大数量
                        const selectedCount = document.querySelectorAll('.free-gift-checkbox:checked').length;
                        
                        if (selectedCount > maxSelections) {
                          this.checked = false;
                          showMaxMessage();
                          return;
                        }
                      }
                    }
                    
                    card.classList.toggle('selected', this.checked);
                    saveFreeGiftSelection();
                  });
                  
                  card.addEventListener('click', function(e) {
                    if (e.target.closest('.free-gift-checkbox-wrapper')) return;
                    checkbox.checked = !checkbox.checked;
                    checkbox.dispatchEvent(new Event('change'));
                  });
                });
                
                restoreFreeGiftSelection();
              }
              
              // 保存选中的免费赠品（支持多选）
              function saveFreeGiftSelection() {
                const selectedCheckboxes = document.querySelectorAll('.free-gift-checkbox:checked');
                const selections = [];
                
                selectedCheckboxes.forEach(checkbox => {
                  const card = checkbox.closest('.free-gift-product-card');
                  selections.push({
                    variantId: card.dataset.variantId,
                    productId: card.dataset.productId,
                    productHandle: card.dataset.productHandle
                  });
                });
                
                if (selections.length > 0) {
                  sessionStorage.setItem('free_gift_selection_' + mainProductId, JSON.stringify({
                    selections: selections,
                    mainProductId: mainProductId
                  }));
                } else {
                  sessionStorage.removeItem('free_gift_selection_' + mainProductId);
                }
              }
              
              // 从sessionStorage恢复免费赠品选择（支持多选）
              function restoreFreeGiftSelection() {
                const saved = sessionStorage.getItem('free_gift_selection_' + mainProductId);
                if (saved) {
                  try {
                    const data = JSON.parse(saved);
                    const selections = data.selections || [];
                    
                    // 先清除所有默认选中状态（防止与 sessionStorage 中的选择叠加）
                    document.querySelectorAll('.free-gift-checkbox').forEach(cb => {
                      cb.checked = false;
                      cb.closest('.free-gift-product-card')?.classList.remove('selected');
                    });
                    
                    // 然后恢复 sessionStorage 中保存的选择
                    selections.forEach(selection => {
                      const checkbox = document.querySelector(`.free-gift-checkbox[data-variant-id="${selection.variantId}"]`);
                      if (checkbox) {
                        checkbox.checked = true;
                        checkbox.closest('.free-gift-product-card')?.classList.add('selected');
                      }
                    });
                  } catch (e) {
                    console.error('[免费赠品恢复失败]', e);
                  }
                }
              }
              

              // 获取所有选中的免费赠品（多选）
              window.getSelectedFreeGifts = function() {
                const items = [];
                document.querySelectorAll('.free-gift-checkbox:checked').forEach(checkbox => {
                  const card = checkbox.closest('.free-gift-product-card');
                  items.push({
                    variantId: parseInt(card.dataset.variantId),
                    productId: card.dataset.productId,
                    productHandle: card.dataset.productHandle,
                    mainProductId: mainProductId
                  });
                });
                return items;
              };
              
              // 向后兼容：返回第一个选中的
              window.getSelectedFreeGift = function() {
                const gifts = window.getSelectedFreeGifts();
                return gifts.length > 0 ? gifts[0] : null;
              };
              // 清除免费赠品选择
              window.clearFreeGiftSelection = function() {
                document.querySelectorAll('.free-gift-checkbox').forEach(checkbox => {
                  checkbox.checked = false;
                });
                document.querySelectorAll('.free-gift-product-card').forEach(card => {
                  card.classList.remove('selected');
                });
                sessionStorage.removeItem('free_gift_selection_' + mainProductId);
              };
              
              if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initFreeGiftProducts);
              } else {
                initFreeGiftProducts();
              }
            })();
          </script>
        {%- when 'buy_buttons' -%}
          <div
            class="product__block product__block--{{ block.type }}"
            {{ block.shopify_attributes }}
          >
            {%- render 'buy-buttons',
              block: block,
              product: product,
              product_form_id: product_form_id,
              section_id: section.id,
              product_id: product.id
            -%}
          </div>
        {%- when 'logistics' -%}
          <div class="product__block logistics-box">
            <ul class="logistics-ul">
              <li>{% render 'icon-car-blue', size: 'small' %}30 Tage Rückgaberecht</li>
              <li>
                {%- render 'icon-love', size: 'small' -%}
                10 Jahre Garantie
              </li>
              <li>
                {%- render 'icon-double-arrow', size: 'small' -%}
                Kostenlose und schnelle Lieferung
              </li>
              <li>
                {%- render 'icon-chat', size: 'small' -%}
                Lebenslanger Kundenservice
              </li>
              <li>
                {%- render 'icon-money', :'small' -%}
                30 Tage Preisgarantie
              </li>
            </ul>
          </div>
        {%- when 'pickup_availability' -%}
          <div
            class="product__block product__block--{{ block.type }}"
            {{ block.shopify_attributes }}
          >
            {%- render 'product-pickup-availability', product: product -%}
          </div>
        {%- when 'badges' -%}
          <div
            class="product__block product__block--{{ block.type }} product__badges flex flex-wrap items-center"
            id="Badges-{{ section.id }}"
            {{ block.shopify_attributes }}
          >
            {%- render 'product-badges', block: block, product: product, section_id: section.id -%}
          </div>
        {%- when 'shipping' -%}
          <div
            class="product__block product__block--{{ block.type }}"
            {{ block.shopify_attributes }}
          >
            <ul class="icon-with-text icon-with-text--vertical list-unstyled">
              {%- if block.settings.deliver_days != blank -%}
                <li class="icon-with-text__item">
                  <svg
                    fill="currentColor"
                    aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 256 256"
                  >
                    <path d="M245.57,117.78l-14-35a13.93,13.93,0,0,0-13-8.8H182V64a6,6,0,0,0-6-6H24A14,14,0,0,0,10,72V184a14,14,0,0,0,14,14H42.6a30,30,0,0,0,58.8,0h53.2a30,30,0,0,0,58.8,0H232a14,14,0,0,0,14-14V120A6,6,0,0,0,245.57,117.78ZM182,86h36.58a2,2,0,0,1,1.86,1.26L231.14,114H182ZM22,72a2,2,0,0,1,2-2H170v68H22ZM72,210a18,18,0,1,1,18-18A18,18,0,0,1,72,210Zm82.6-24H101.4a30,30,0,0,0-58.8,0H24a2,2,0,0,1-2-2V150H170v15.48A30.1,30.1,0,0,0,154.6,186ZM184,210a18,18,0,1,1,18-18A18,18,0,0,1,184,210Zm50-26a2,2,0,0,1-2,2H213.4A30.05,30.05,0,0,0,184,162c-.67,0-1.34,0-2,.07V126h52Z"></path>
                  </svg>
                  {%- liquid
                    assign date_format = block.settings.date_format | default: '%b %d'
                    assign range = 2 | times: 24 | times: 60 | times: 60
                    assign deliver_in = block.settings.deliver_days | times: 24 | times: 60 | times: 60
                    assign now = 'now' | date: '%s'
                    assign from = now | plus: deliver_in | minus: range | date: date_format
                    assign to = now | plus: deliver_in | plus: range | date: date_format
                  -%}
                  <div>
                    {{- block.settings.deliver_text | strip_html }}
                    <span>{{ from }} - {{ to }}</span>
                  </div>
                </li>
              {%- endif -%}
            </ul>
          </div>
        {%- when 'complementary' -%}
          <div
            class="product__block product__block--{{ block.type }} product__block--{{ block.type }}-{% if block.settings.make_collapsible_row %}collapsible{% else %}inline{% endif %}{% if block.settings.block_heading != blank %} has-heading{% endif %}"
            {{ block.shopify_attributes }}
          >
            <script src="{{ 'product-recommendations.js' | asset_url }}" defer="defer"></script>
            <script src="{{ 'complementary-product-slider.js' | asset_url }}" defer="defer"></script>
            <product-recommendations
              class="complementary-products{% if block.settings.enable_quick_add %} complementary-products-contains-quick-add{% endif %}"
              data-url="{{ routes.product_recommendations_url }}?section_id={{ section.id }}&product_id={{ product.id }}&limit={{ block.settings.product_list_limit }}&intent=complementary"
            >
              {%- if recommendations.performed and recommendations.products_count > 0 -%}
                <aside aria-label="{{ 'accessibility.complementary_products' | t }}">
                  <div class="complementary-products__container">
                    {%- if block.settings.make_collapsible_row -%}
                      <details
                        id="Details-{{ block.id }}-{{ section.id }}"
                        class="accordion-details"
                        is="accordion-group"
                        open
                      >
                        <summary class="accordion-details__summary flex items-center justify-between">
                    {%- endif %}
                    {%- if block.settings.make_collapsible_row -%}
                      <div class="flex items-center gap-2">
                        {% render 'icons', icon: block.settings.icon %}
                        <h2 class="h4">{{ block.settings.block_heading }}</h2>
                      </div>
                    {%- else -%}
                      <h2 class="h4 complementary-products__heading">{{ block.settings.block_heading }}</h2>
                    {%- endif -%}
                    {%- if block.settings.make_collapsible_row -%}
                      {%- render 'icon-plus-toggle' -%}
                      </summary>
                      <div class="accordion-details__content">
                    {%- endif -%}
                    <complementary-product-slider class="slider-controls--grouped-always block relative">
                      {%- liquid
                        assign products_per_page = block.settings.products_per_page
                        assign number_of_slides = recommendations.products_count
                        if products_per_page > 1
                          assign number_of_slides = recommendations.products_count | plus: 0.0 | divided_by: products_per_page | ceil
                        endif
                      -%}
                      <div class="swiper">
                        <div
                          class="swiper-wrapper"
                          role="list"
                          {% if number_of_slides > 1 %}
                            aria-label="{{ 'general.slider.name' | t }}"
                          {% endif %}
                        >
                          {%- if products_per_page > 1 -%}
                            {%- for i in (1..number_of_slides) -%}
                              <div class="swiper-slide" role="listitem" tabindex="-1">
                                <ul
                                  class="complementary-products__list list-unstyled flex flex-col gap-4"
                                  role="list"
                                >
                                  {%- for product in recommendations.products
                                    limit: products_per_page
                                    offset: continue
                                  -%}
                                    <li>
                                      {% render 'card-product-list',
                                        section_index: section.index,
                                        index: forloop.index,
                                        product: product,
                                        image_ratio: block.settings.image_ratio,
                                        enable_quick_add: block.settings.enable_quick_add
                                      %}
                                    </li>
                                  {%- endfor -%}
                                </ul>
                              </div>
                            {%- endfor -%}
                          {%- else -%}
                            {%- for product in recommendations.products -%}
                              <div class="swiper-slide" role="listitem" tabindex="-1">
                                {% render 'card-product-list',
                                  section_index: section.index,
                                  index: forloop.index,
                                  product: product,
                                  image_ratio: block.settings.image_ratio,
                                  enable_quick_add: block.settings.enable_quick_add
                                %}
                              </div>
                            {%- endfor -%}
                          {%- endif -%}
                        </div>
                      </div>
                      {%- if number_of_slides > 1 -%}
                        <div class="slider-controls--group">
                          <div class="slider-controls">
                            <button
                              class="swiper-button-prev"
                              name="previous"
                              aria-label="{{ 'general.slider.previous_slide' | t }}"
                            >
                              {% render 'icon-slider-prev' %}
                            </button>
                            <button
                              class="swiper-button-next"
                              name="next"
                              aria-label="{{ 'general.slider.next_slide' | t }}"
                            >
                              {% render 'icon-slider-next' %}
                            </button>
                            <div class="swiper-pagination"></div>
                          </div>
                        </div>
                      {%- endif -%}
                    </complementary-product-slider>
                    {%- if block.settings.make_collapsible_row -%}
                      </div>
                      </details>
                    {%- endif -%}
                  </div>
                </aside>
              {%- endif -%}
              {%- if block.settings.enable_quick_add -%}
                <script src="{{ 'quick-view.js' | asset_url }}" defer="defer"></script>
              {%- endif -%}
            </product-recommendations>
          </div>
        {%- when 'icon-with-text' -%}
          <div
            class="product__block product__block--{{ block.type }} product__block--{{ block.type }}-{{ block.settings.layout }}"
            {{ block.shopify_attributes }}
          >
            {% render 'icon-with-text',
              layout: block.settings.layout,
              title_size: block.settings.title_size,
              title_font: block.settings.title_font,
              heading_1: block.settings.heading_1,
              content_image_1: block.settings.content_image_1,
              image_1: block.settings.image_1,
              icon_1: block.settings.icon_1,
              content_image_2: block.settings.content_image_2,
              heading_2: block.settings.heading_2,
              image_2: block.settings.image_2,
              icon_2: block.settings.icon_2,
              heading_3: block.settings.heading_3,
              image_3: block.settings.image_3,
              icon_3: block.settings.icon_3
            %}
          </div>
        {%- when 'line_item_property' -%}
          <div
            class="product__block product__block--{{ block.type }}"
            {{ block.shopify_attributes }}
          >
            {%- assign property_name = block.settings.property_name | escape -%}
            {%- if block.settings.property_type == 'checkbox' and property_name != blank -%}
              <div class="form-field" data-custom-property>
                <div class="flex items-center gap-x-3">
                  <input
                    type="hidden"
                    name="properties[{{ property_name }}]"
                    form="{{ product_form_id }}"
                    value="{{ block.settings.property_uncheck_value | escape }}"
                  >
                  <input
                    type="checkbox"
                    id="LineItemProperty-{{ block.id }}"
                    name="properties[{{ property_name }}]"
                    form="{{ product_form_id }}"
                    value="{{ block.settings.property_checked_value | escape }}"
                    {% if block.settings.required %}
                      required
                    {% endif %}
                  >
                  <label class="flex-1" for="LineItemProperty-{{ block.id }}">
                    {{- property_name -}}
                  </label>
                </div>
              </div>
            {%- elsif block.settings.property_type == 'radio' -%}
              <div class="form-field" data-custom-property>
                {%- assign options = block.settings.property_options | split: ',' -%}
                {%- if property_name != blank -%}
                  <label class="form-label font-body-bold" for="LineItemProperty-{{ block.id }}">
                    {{- property_name -}}
                    {% if block.settings.required %}
                      <span aria-hidden="true">*</span>
                    {% endif %}
                  </label>
                  {%- if options.size > 0 -%}
                    <div class="flex flex-wrap gap-x-6 gap-y-2{% if block.settings.radio_layout == 'vertical' %} flex-col{% else %} flex-row items-center{% endif %}">
                      {%- for option in options -%}
                        <div class="flex items-center gap-x-3">
                          <input
                            type="radio"
                            id="LineItemProperty-{{ block.id }}-{{ option | escape }}"
                            name="properties[{{ property_name }}]"
                            form="{{ product_form_id }}"
                            value="{{ option | escape }}"
                            {% if forloop.first %}
                              checked
                            {% endif %}
                            {% if block.settings.required %}
                              required
                            {% endif %}
                          >
                          <label for="LineItemProperty-{{ block.id }}-{{ option | escape }}">
                            {{- option -}}
                          </label>
                        </div>
                      {%- endfor -%}
                    </div>
                  {%- endif -%}
                {%- endif -%}
              </div>
            {%- else -%}
              {%- case block.settings.property_type -%}
                {%- when 'text' -%}
                  <div class="form-field" data-custom-property>
                    {%- if property_name != blank -%}
                      <label class="form-label font-body-bold" for="LineItemProperty-{{ block.id }}">
                        {{- property_name -}}
                        {% if block.settings.required %}
                          <span aria-hidden="true">*</span>
                        {% endif %}
                      </label>
                      <input
                        type="text"
                        id="LineItemProperty-{{ block.id }}"
                        name="properties[{{ property_name }}]"
                        form="{{ product_form_id }}"
                        class="form-control"
                        value="{{ block.settings.property_value | escape }}"
                        placeholder="{{ block.settings.property_placeholder | escape }}"
                        {% if block.settings.required %}
                          required
                        {% endif %}
                      >
                    {%- endif -%}
                  </div>
                {%- when 'textarea' -%}
                  <div class="form-field" data-custom-property>
                    {%- if property_name != blank -%}
                      <label class="form-label font-body-bold" for="LineItemProperty-{{ block.id }}">
                        {{- property_name -}}
                        {% if block.settings.required %}
                          <span aria-hidden="true">*</span>
                        {% endif %}
                      </label>
                      <textarea
                        id="LineItemProperty-{{ block.id }}"
                        name="properties[{{ property_name }}]"
                        form="{{ product_form_id }}"
                        class="form-control"
                        placeholder="{{ block.settings.property_placeholder | escape }}"
                        {% if block.settings.required %}
                          required
                        {% endif %}
                      >
                      {{- block.settings.property_value | escape -}}
                    </textarea>
                    {%- endif -%}
                  </div>
                {%- when 'select' -%}
                  <div class="form-field" data-custom-property>
                    {%- if property_name != blank -%}
                      <label class="form-label font-body-bold" for="LineItemProperty-{{ block.id }}">
                        {{- property_name -}}
                        {% if block.settings.required %}
                          <span aria-hidden="true">*</span>
                        {% endif %}
                      </label>
                      {%- assign options = block.settings.property_options | split: ',' -%}
                      <div class="select">
                        <select
                          id="LineItemProperty-{{ block.id }}"
                          name="properties[{{ property_name }}]"
                          form="{{ product_form_id }}"
                          class="form-control form-control--select"
                          {% if block.settings.required %}
                            required
                          {% endif %}
                        >
                          {% if block.settings.property_placeholder != blank %}
                            <option value="" disabled>
                              {{- block.settings.property_placeholder -}}
                            </option>
                          {% endif %}
                          {%- for option in options -%}
                            <option value="{{ option | escape }}">
                              {{- option -}}
                            </option>
                          {%- endfor -%}
                        </select>
                        {% render 'icon-caret-down' %}
                      </div>
                    {%- endif -%}
                  </div>
              {%- endcase -%}
            {%- endif -%}
          </div>
      {%- endcase -%}
    {%- endfor -%}
  </div>
  {%- if show_details_link == true -%}
    <a
      {% if product == blank %}
        role="link" aria-disabled="true"
      {% else %}
        href="{{ product.url }}"
      {% endif %}
      class="product__view-details btn btn--with-icon"
    >
      {{- 'products.product.view_full_details' | t -}}
      {% render 'icon-caret' %}
    </a>
  {%- endif -%}
</div>
